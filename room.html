<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Holiday Harmony ‚Äî Room</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --card:#ffffffcc;
      --border:#e7e7ef;
      --text:#1c1c22;
      --muted:#6b6b78;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --radius:18px;
    }
    *, *::before, *::after { box-sizing: border-box; }

    body{
      font-family: Inter, system-ui, Arial;
      max-width: 1100px;
      margin: 18px auto;
      padding: 0 14px;
      color: var(--text);
      background:
        linear-gradient(180deg, rgba(246,247,255,.88), rgba(255,255,255,.95)),
        url("assets/img/bg.jpg");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    .top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom: 6px;
    }
    h1{ margin:0; font-size: 22px; }

    .pill{
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:10px 12px;
      max-width:100%;
      overflow:auto;
      box-shadow: var(--shadow);
      font-size: 14px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .pill input[type="checkbox"], .pill input[type="date"]{ width:auto; padding:8px 10px; margin:0; }

    .pill button{
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:8px 12px;
      font-weight:800;
      cursor:pointer;
      width:auto;
      margin:0;
      transition: transform .12s ease;
    }
    .pill button:active{ transform: translateY(1px); }
    .pill input{ width:100%; padding:12px; border-radius:14px; border:1px solid var(--border); margin:8px 0; font-size:15px; background:#fff; }

    .card{
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px;
      margin: 12px 0;
      background: var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      animation: fadeIn .24s ease;
    }
    @keyframes fadeIn{
      from{ opacity:0; transform:translateY(5px) }
      to{ opacity:1; transform:translateY(0) }
    }

    input,textarea,button,select{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      margin:8px 0;
      font-size: 15px;
      background:#fff;
    }
    textarea{ resize: vertical; }

    button{
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,.06);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    button:hover{ box-shadow: 0 10px 26px rgba(0,0,0,.09); }
    button:active{ transform: translateY(1px); }
    small{ color: var(--muted); }

    .grid{ display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 980px){ .grid{ grid-template-columns: 1fr 1fr; } }

    .kpiRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
    .kpi{
      border:1px solid var(--border);
      background:#fff;
      border-radius: 14px;
      padding: 10px 12px;
      flex: 1;
      min-width: 210px;
    }
    .kpi b{ display:block; font-size: 16px; }

    .moodRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 8px; }
    .moodBtn{
      flex: 1;
      min-width: 120px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:12px;
      border-radius: 14px;
      border:1px solid var(--border);
      background:#fff;
      font-weight: 900;
    }
    .moodBtn span{ font-size: 18px; }
    .moodSelected{ outline: 3px solid rgba(0,0,0,.09); }

    .miniRow{ display:flex; gap:10px; flex-wrap:wrap; }
    .miniRow button{ flex:1; min-width: 200px; }

    /* ---- Vibe bar ---- */
    .vibeWrap{
      margin-top:12px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:999px;
      overflow:hidden;
      height:14px;
      position: relative;
    }
    .vibeBar{
      height:100%;
      width:0%;
      transition: width .45s ease;
      background: linear-gradient(90deg, #ffe7b3, #fff2d6);
      background-size: 200% 100%;
      animation: vibeFlow 6s linear infinite;
    }
    @keyframes vibeFlow{
      from { background-position: 0% 0%; }
      to   { background-position: 200% 0%; }
    }
    .vibePulse{ animation: vibePulse 700ms ease; }
    @keyframes vibePulse{
      0%   { box-shadow: 0 0 0 rgba(0,0,0,0); transform: scale(1); }
      30%  { box-shadow: 0 0 26px rgba(0,0,0,.10); transform: scale(1.01); }
      100% { box-shadow: 0 0 0 rgba(0,0,0,0); transform: scale(1); }
    }

    /* ---- Memory feed grid ---- */
    .memoryGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin-bottom: 18px;
    }
    @media (min-width: 980px){
      .memoryGrid{ grid-template-columns: 1fr 1fr; }
    }

    .memoryCard{
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px;
      background: var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      animation: fadeIn .22s ease;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .memoryCard:hover{
      transform: translateY(-1px);
      box-shadow: 0 14px 40px rgba(0,0,0,.10);
    }

    .memoryCardActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .reactBtn{
      border:1px solid var(--border);
      background:#fff;
      border-radius: 999px;
      padding:8px 12px;
      font-weight:900;
      cursor:pointer;
      width:auto;
      margin:0;
      transition: transform .10s ease;
    }
    .reactBtn:active{ transform: scale(1.05); }

    /* ---- Pause banner ---- */
    .pauseBanner{
      border:1px solid var(--border);
      background: rgba(255,255,255,.95);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
      margin: 12px 0;
      display:none;
    }

    /* ---- Recap modal ---- */
    .modalBack{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.40);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 14px;
      z-index: 9999;
    }
    .modal{
      width:min(820px, 100%);
      border-radius: 22px;
      background: #fff;
      border: 1px solid var(--border);
      box-shadow: 0 18px 70px rgba(0,0,0,.25);
      padding: 16px;
    }
    .modal h2{ margin: 4px 0 8px; }
    .modal .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .modal .box{
      border:1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      flex:1;
      min-width: 220px;
      background: #fafafe;
    }

    /* ---- Movie Night (Netflix-ish grid) ---- */
    .movieGrid{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 720px){
      .movieGrid{ grid-template-columns: 1fr 1fr; }
    }
    .movieCard{
      border:1px solid var(--border);
      border-radius: 16px;
      overflow:hidden;
      background:#fff;
      box-shadow: 0 10px 26px rgba(0,0,0,.08);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .movieCard:hover{
      transform: translateY(-1px);
      box-shadow: 0 14px 40px rgba(0,0,0,.10);
    }
    .moviePoster{
      width:100%;
      aspect-ratio: 2 / 3;
      object-fit: cover;
      display:block;
      background: #f0f0f6;
    }
    .movieMeta{
      padding: 10px;
    }
    .movieMeta b{ display:block; font-size: 14px; }
    .movieMeta small{ display:block; margin-top: 4px; }
    .movieActions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .movieVoteBtn{
      width:auto;
      margin:0;
      border-radius: 999px;
      padding: 8px 12px;
    }
    .movieTopPick{
      border:1px solid var(--border);
      border-radius: 14px;
      padding: 12px;
      background:#fff;
      margin-top: 10px;
    }

    .tmdbLink{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      text-decoration:none;
      color: var(--text);
      border:1px solid var(--border);
      background:#fff;
      border-radius: 999px;
      padding:8px 12px;
      font-weight:900;
      width:auto;
    }

    /* ---- Polish: focus + placeholders ---- */
    input::placeholder, textarea::placeholder{
      color: rgba(107,107,120,.75);
    }
    input:focus, textarea:focus, select:focus{
      outline: none;
      border-color: rgba(30,30,40,.35);
      box-shadow: 0 0 0 4px rgba(30,30,40,.08);
    }
    button:focus-visible{
      outline: none;
      box-shadow: 0 0 0 4px rgba(30,30,40,.10), 0 10px 26px rgba(0,0,0,.09);
    }
    .pill button, .pill input[type="date"]{ white-space: nowrap; }
    @media (max-width: 520px){
      .pill{ font-size: 13px; }
      .pill button{ padding:7px 10px; }
    }

  </style>
</head>

<body>
  <div class="top">
    <h1 id="roomTitle">üè† Room: <span id="roomLabel"></span></h1>

    <div class="pill" id="shareLink"></div>

    <div class="pill">
      <span id="soundLabel">üîä Sound</span>
      <input id="soundToggle" type="checkbox" checked>
      <button id="partyBtn" type="button">üéâ Party</button>
      <button id="recapBtn" type="button">üì∏ Recap</button>
      <button id="exportBtn" type="button">üßæ Export</button>
      <button id="langBtn" type="button">EN / RU</button>

      <span style="margin-left:6px; font-weight:800;">üìÖ</span>
      <input id="datePick" type="date" style="width:auto;">
      <button id="btnToday" type="button">Today</button>
      <button id="btnYday" type="button">Yesterday</button>
      <button id="btn7" type="button">Last 7</button>
      <button id="btn30" type="button">Last 30</button>
    </div>
  </div>

  <div class="pill" id="debug">Booting‚Ä¶</div>

  <div id="pauseBanner" class="pauseBanner"></div>

  <div class="card">
    <h2 id="appTitle" style="margin:0;">Holiday Harmony</h2>
    <small id="appSubtitle">Co-op family mini-game: collect good moments, keep the vibe warm.</small>
  </div>

  <div class="grid">
    <div class="card">
      <h3 id="motdTitle">‚≠ê Memory of the Day</h3>
      <div id="motdOut"><small>Loading‚Ä¶</small></div>
      <small id="motdHint">Most loved memory today (by reactions).</small>
    </div>

    <div class="card">
      <h3 id="missionTitle">üéØ Today‚Äôs Gentle Challenge</h3>
      <div id="missionOut" style="border:1px solid #e7e7ef; border-radius:14px; padding:12px; background:#fff;">Loading‚Ä¶</div>
      <div class="miniRow" style="margin-top:10px;">
        <button id="missionDoneBtn" type="button">‚úÖ I did it</button>
        <button id="missionNewBtn" type="button">üé≤ New (just for me)</button>
      </div>
      <small id="missionHint">Shared daily challenge + personal reroll option.</small>
    </div>
  </div>


  <div id="exportCard">

  <div class="card">
    <h3 id="dashTitle">üìä Family Dashboard</h3>
    <div id="happinessLevel">Loading‚Ä¶</div>

    <div class="kpiRow">
      <div class="kpi"><b id="kpiMemories">‚Äî</b><small id="kpiMemoriesLabel">Happy moments today</small></div>
      <div class="kpi"><b id="kpiCheckins">‚Äî</b><small id="kpiCheckinsLabel">Mood check-ins today</small></div>
      <div class="kpi"><b id="kpiMood">‚Äî</b><small id="kpiMoodLabel">Today‚Äôs vibe</small></div>
      <div class="kpi"><b id="kpiReacts">‚Äî</b><small id="kpiReactsLabel">Reactions today</small></div>
    </div>

    <div id="vibeWrap" class="vibeWrap" title="Family vibe meter">
      <div id="vibeBar" class="vibeBar"></div>
    </div>

    <div style="margin-top:10px; border:1px solid #e7e7ef; border-radius:14px; padding:12px; background:#fff;" id="recapOut">Loading‚Ä¶</div>
  </div>

  <div class="grid">
    <div class="card">
      <h3 id="checkinTitle">‚úÖ Daily Mood Check-in</h3>
      <input id="name" placeholder="Your name" />
      <small id="checkinHint">Pick your mood for today (you can change it later).</small>

      <div class="moodRow">
        <button class="moodBtn" id="moodGood" type="button"><span>üòá</span><span id="moodGoodLabel">Calm</span></button>
        <button class="moodBtn" id="moodOk" type="button"><span>üòê</span><span id="moodOkLabel">Okay</span></button>
        <button class="moodBtn" id="moodBad" type="button"><span>üò§</span><span id="moodBadLabel">Overloaded</span></button>
      </div>

      <small id="moodStatus"></small>

      <div class="miniRow" style="margin-top:10px;">
        <button id="pauseBtn" type="button">üßò I need a pause</button>
        <button id="defuseBtn" type="button">üßØ Reset Moment</button>
      </div>

      <div class="miniRow" style="margin-top:10px;">
        <button id="choreBtn" type="button">üé° Chore Roulette</button>
        <button id="activityBtn" type="button">üé≤ Activity</button>
      </div>

      <div id="defuseOut"></div>
      <div id="activityOut"></div>
    </div>

    <div class="card">
      <h3 id="awardsTitle">üèÜ Awards Preview</h3>
      <div id="awardsOut">Loading‚Ä¶</div>
      <small id="awardsHint">Friendly awards only. No roasting. üòÑ</small>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h3 id="vaultTitle">‚ú® Memory Vault</h3>

      <div class="grid" style="grid-template-columns: 1fr 1fr; gap:10px;">
        <select id="tagSelect">
          <option value="">(no tag)</option>
          <option value="üçΩ">üçΩ Food</option>
          <option value="üòÇ">üòÇ Funny</option>
          <option value="üé¨">üé¨ Movie</option>
          <option value="‚òï">‚òï Tea</option>
          <option value="üéÅ">üéÅ Gifts</option>
          <option value="üß∏">üß∏ Kids</option>
        </select>

        <button id="postBtn" type="button">Post memory</button>
      </div>

      <textarea id="moment" rows="3" placeholder="Happy moment (e.g. We laughed together at breakfast)"></textarea>
      <small id="status"></small>

      <div style="margin-top:10px; border:1px solid #e7e7ef; border-radius:14px; padding:12px; background:#fff;">
        <b id="reactionsLabel">Reactions:</b>
        <span id="reactionsHint">Tap ‚ù§Ô∏è üòÇ ‚≠ê on any memory (tap again to undo).</span>
      </div>
    </div>

    <div class="card">
      <h3 id="bingoTitle">üéØ Family Bingo</h3>
      <div id="bingoOut" style="border:1px solid #e7e7ef; border-radius:14px; padding:12px; background:#fff;">
        Loading‚Ä¶
      </div>
      <small id="bingoHint">Tap squares as they happen. It‚Äôs a co-op board üôÇ</small>
    </div>
  </div>

  <!-- NEW: Movie Night -->
  <div class="card">
    <h3 id="movieTitle">üçø Movie Night (Vote)</h3>
    <small id="movieHint">Tap üëç to vote. Tap again to unvote. Everyone sees the same winner.</small>

    <div class="movieActions">
      <button id="movieReloadBtn" type="button" class="movieVoteBtn">üîÑ Refresh list</button>
      <button id="movieExportBtn" type="button" class="movieVoteBtn">üßæ Export movie card</button>
    </div>

    <div id="movieTopPick" class="movieTopPick">Loading‚Ä¶</div>
    <div id="movieGrid" class="movieGrid"></div>
    <small id="movieStatus"></small>
  </div>

  <div id="moodBoard" class="card"><small>Loading‚Ä¶</small></div>

  <div id="motdDivider" class="card">
    <small id="feedTitle">‚ú® Memory Feed</small>
  </div>

  <div id="list" class="memoryGrid"></div>

  <!-- Recap modal -->
  <div id="modalBack" class="modalBack">
    <div class="modal">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
        <h2 id="recapTitle">üì∏ Today‚Äôs Recap</h2>
        <button id="closeRecapBtn" type="button" style="width:auto;">‚úñ</button>
      </div>

      <div id="recapModalBody">
        <div class="row">
          <div class="box" id="recapModalKpis">Loading‚Ä¶</div>
          <div class="box" id="recapModalMotd">Loading‚Ä¶</div>
        </div>
        <div class="row" style="margin-top:10px;">
          <div class="box" id="recapModalAwards">Loading‚Ä¶</div>
          <div class="box">
            <b id="recapHowto">How to share:</b>
            <div id="recapHowtoText" style="margin-top:8px;">
              Take a screenshot and send it to the family chat üôÇ
            </div>
          </div>
        </div>
      </div>

      <small id="recapFooterHint">Tip: open this screen on a phone for the best screenshot.</small>
    </div>
  </div>

    </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.11.11/dist/html-to-image.min.js"></script>
  <script src="app.js?v=1011"></script>
</body>
</html>
